<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ChefAI Smart</title>

<style>
body {
    font-family: Arial, sans-serif;
    max-width: 900px;
    margin: 40px auto;
    background: #fff7f0;
}

h1 {
    text-align: center;
    color: #d35400;
}

.card {
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    margin-bottom: 20px;
}

textarea {
    width: 100%;
    height: 80px;
    padding: 10px;
    font-size: 14px;
}

button {
    padding: 10px 15px;
    margin-top: 10px;
    background: #e67e22;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}

button:hover {
    background: #ca6f1e;
}

#result {
    white-space: pre-wrap;
    line-height: 1.6;
}

.status {
    font-size: 13px;
    margin-top: 10px;
}
</style>
</head>
<body>

<h1>üë©üèª‚Äçüç≥ ChefAI Smart</h1>

<div class="card">
    <h3>ü•ï Nh·∫≠p nguy√™n li·ªáu (c√°ch nhau b·∫±ng d·∫•u ph·∫©y)</h3>
    <textarea id="ingredients" placeholder="V√≠ d·ª•: tr·ª©ng, c√† chua, h√†nh, tr·ª©ng"></textarea>
    <button onclick="suggestDish()">G·ª£i √ù M√≥n</button>
</div>

<div class="card">
    <h3>üç≤ Nh·∫≠p t√™n m√≥n ƒë·ªÉ xem c√°ch n·∫•u</h3>
    <textarea id="dishName" placeholder="V√≠ d·ª•: m√¨ x√†o b√≤"></textarea>
    <button onclick="cookDish()">N·∫•u M√≥n</button>
</div>

<div class="card">
    <h3>üçΩÔ∏è K·∫øt qu·∫£</h3>
    <div id="result"></div>
    <div class="status" id="status"></div>
</div>

<script>
const API_KEY = "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";
const MODEL = "llama-3.1-8b-instant";
let previousSuggestions = [];

function cleanIngredients(input) {
    const items = input.split(",")
        .map(i => i.trim().toLowerCase())
        .filter(i => i !== "");
    return [...new Set(items)];
}

async function callAI(promptText) {
    const status = document.getElementById("status");
    status.innerText = "‚è≥ ƒêang g·ªçi AI...";

    try {
        const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${API_KEY}`
            },
            body: JSON.stringify({
                model: MODEL,
                messages: [
                    {
                        role: "system",
                        content: `
B·∫°n l√† ƒë·∫ßu b·∫øp chuy√™n nghi·ªáp v√† logic.
- Kh√¥ng g·ª£i √Ω m√≥n tr√πng l·∫∑p.
- N·∫øu thi·∫øu nguy√™n li·ªáu quan tr·ªçng, ƒë·ªÅ xu·∫•t b·ªï sung.
- Tr·∫£ l·ªùi r√µ r√†ng, c√≥ c·∫•u tr√∫c.
`
                    },
                    {
                        role: "user",
                        content: promptText
                    }
                ],
                temperature: 0.6
            })
        });

        const text = await response.text();

        if (!response.ok) {
            throw new Error(text);
        }

        const data = JSON.parse(text);
        status.innerText = "‚úÖ AI ƒë√£ tr·∫£ l·ªùi";
        return data.choices[0].message.content;

    } catch (error) {
        status.innerText = "‚ùå L·ªói x·∫£y ra";
        return "Chi ti·∫øt l·ªói:\n" + error.message;
    }
}

async function suggestDish() {
    const raw = document.getElementById("ingredients").value;
    const cleaned = cleanIngredients(raw);

    if (cleaned.length === 0) {
        alert("Vui l√≤ng nh·∫≠p nguy√™n li·ªáu.");
        return;
    }

    const prompt = `
T√¥i c√≥ c√°c nguy√™n li·ªáu: ${cleaned.join(", ")}.

H√£y:
1. G·ª£i √Ω 3 m√≥n ƒÉn KH√îNG tr√πng v·ªõi: ${previousSuggestions.join(", ")}
2. N·∫øu thi·∫øu nguy√™n li·ªáu ch√≠nh, ghi r√µ c·∫ßn th√™m g√¨.
3. M·ªói m√≥n g·ªìm:
   - T√™n m√≥n
   - L√Ω do ph√π h·ª£p
   - ƒê·ªô kh√≥
`;

    const result = await callAI(prompt);
    document.getElementById("result").innerText = result;
    previousSuggestions.push(result);
}

async function cookDish() {
    const dish = document.getElementById("dishName").value.trim();

    if (!dish) {
        alert("Vui l√≤ng nh·∫≠p t√™n m√≥n.");
        return;
    }

    const prompt = `
H√£y h∆∞·ªõng d·∫´n n·∫•u m√≥n ${dish} g·ªìm:
- Nguy√™n li·ªáu ƒë·∫ßy ƒë·ªß
- C√°c b∆∞·ªõc chi ti·∫øt (ƒë√°nh s·ªë)
- Th·ªùi gian n·∫•u
- M·∫πo l√†m ngon h∆°n

N·∫øu m√≥n kh√¥ng t·ªìn t·∫°i, h√£y n√≥i r√µ.
`;

    const result = await callAI(prompt);
    document.getElementById("result").innerText = result;
}
</script>

</body>
</html>